<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Available Flights</title>
    <link rel="stylesheet" href="/styles/flights.css" />
</head>
<body>
<header>
    <nav class="navbar">
        <img class="logo" th:src="@{/images/Southwest-Airlines-Logo-2014-present.jpg}" alt="Southwest Airlines Logo">
        <form action="/perform_logout" method="post">
            <button type="submit" class="button">Logout</button>
        </form>
    </nav>
</header>
<!-- Available Flights Table -->
<div th:if="${outboundFlights != null || roundTripFlights != null}">
    <div th:if="${#lists.isEmpty(outboundFlights) && #lists.isEmpty(roundTripFlights)}" class="no-flights-message">
        <p>No flights match your search criteria.</p>
        <button class="button" onclick="window.history.back();">Back</button>
    </div>

    <!-- Form for selecting flights -->
    <div class="table-container"> <!-- Updated container class -->
        <form th:action="@{/customer/{customerID}/confirmFlight(customerID=${customerID})}" method="POST">
            <input type="hidden" name="customerID" th:value="${customerID}" />
            <input type="hidden" name="tripType" th:value="${tripType}"/>

            <!-- Outbound Flights for Round Trip or One-Way Flights -->
            <div th:if="${outboundFlights != null && !#lists.isEmpty(outboundFlights)}">
                <h3>Available Flights</h3>
                <button class="button" type="button" onclick="window.history.back();">Back</button>
                <table>
                    <thead>
                    <tr>
                        <th>Flight Number</th>
                        <th>Departure Date</th>
                        <th>Departure Time</th>
                        <th>Arrival Time</th>
                        <th>Departure Airport</th>
                        <th>Arrival Airport</th>
                        <th>Price</th>
                        <th>DashPass Option</th>
                        <th>Select Outbound Flight</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="flight : ${outboundFlights}">
                        <td th:text="${flight.flightNumber}">Flight Number</td>
                        <td th:text="${#temporals.format(flight.departureDate, 'MM-dd-yyyy')}">Departure Date</td>
                        <td th:text="${#temporals.format(flight.departureTime, 'hh:mm a')}">Departure Time</td>
                        <td th:text="${#temporals.format(flight.arrivalTime, 'hh:mm a')}">Arrival Time</td>
                        <td th:text="${flight.departureAirportCode}">Departure Airport Code</td>
                        <td th:text="${flight.arrivalAirportCode}">Arrival Airport Code</td>
                        <td th:text="${#numbers.formatDecimal(flight.price, 1, 'COMMA', 2, 'POINT')}">Flight Price</td>

                        <td>
                            <!-- DashPass Option -->
                            <div th:if="${customer != null}">
                                <div th:if="${customer.dashPasses > 0}">
                                    <input type="radio" name="dashPassOption" value="existing">
                                    <label>Use Existing DashPass</label><br>
                                </div>
                            </div>
                            <div th:if="${flight.numberOfDashPassesAvailable > 0}">
                                <input type="radio" name="dashPassOption" value="purchase">
                                <label>Purchase New DashPass ($50.00)</label><br>
                            </div>
                            <input type="radio" name="dashPassOption" value="none">
                            <label>Do not use DashPass</label>
                        </td>

                        <!-- Select Outbound Flight -->
                        <td>
                            <input type="radio" name="outboundFlightId" th:value="${flight.flightID}" required>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- Return Flights for Round Trip -->
            <div th:if="${roundTripFlights != null && !#lists.isEmpty(roundTripFlights.returnFlights)}">
                <h3>Return Flights</h3>
                <table>
                    <thead>
                    <tr>
                        <th>Flight Number</th>
                        <th>Departure Date</th>
                        <th>Departure Time</th>
                        <th>Arrival Time</th>
                        <th>Departure Airport</th>
                        <th>Arrival Airport</th>
                        <th>Price</th>
                        <th>Select Return Flight</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="flight : ${roundTripFlights.returnFlights}">
                        <td th:text="${flight.flightNumber}">Flight Number</td>
                        <td th:text="${#temporals.format(flight.departureDate, 'MM-dd-yyyy')}">Departure Date</td>
                        <td th:text="${#temporals.format(flight.departureTime, 'hh:mm a')}">Departure Time</td>
                        <td th:text="${#temporals.format(flight.arrivalTime, 'hh:mm a')}">Arrival Time</td>
                        <td th:text="${flight.departureAirportCode}">Departure Airport Code</td>
                        <td th:text="${flight.arrivalAirportCode}">Arrival Airport Code</td>
                        <td th:text="${#numbers.formatDecimal(flight.price, 1, 'COMMA', 2, 'POINT')}">Flight Price</td>

                        <!-- Select Return Flight -->
                        <td>
                            <input type="radio" name="returnFlightId" th:value="${flight.flightID}" required>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- Submit button to confirm both flights -->
            <button class="button" type="submit">Confirm Booking</button>
        </form>
    </div>
</div>

</body>
</html>
